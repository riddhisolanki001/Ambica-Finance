[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Tax Withholding Category",
  "enabled": 1,
  "modified": "2024-01-02 10:47:48.806834",
  "module": "Ambica Finance",
  "name": "Tax Withholding Category Name",
  "script": "frappe.ui.form.on('Tax Withholding Category', {\n    refresh: function(frm) {\n        // Your script logic here\n    },\n    onload: function(frm) {\n        // Check if the document is in Draft state (new form)\n        if (frm.doc.docstatus === 0) {\n            // Set a default value for the __newname field during onload for new forms\n            frm.set_value('__newname', frm.doc.custom_type + '-' + frm.doc.custom_sub_category);\n        }\n    },\n    custom_section: function(frm) {\n        if (frm.doc.category_name) {\n            // Update the __newname field when custom_section changes and category_name is not null\n            frm.set_value('__newname', frm.doc.custom_type + '-' + frm.doc.custom_section + '-' + frm.doc.category_name + '-' + frm.doc.custom_sub_category);\n        } else {\n            // Handle the case when category_name is null\n            // You can run another query or set a different value as needed\n            frm.set_value('__newname', frm.doc.custom_type + '-' + frm.doc.custom_section + '-' + frm.doc.custom_sub_category);\n        }\n        \n    },\n    custom_sub_category: function(frm) {\n        // Set a default value for the __newname field by concatenating custom_type and custom_section\n        frm.set_value('__newname', frm.doc.custom_type + '-' + frm.doc.custom_section + '-' + frm.doc.category_name + '-' + frm.doc.custom_sub_category);\n    },\n    custom_type: function(frm) {\n        // Set a default value for the __newname field by concatenating custom_type and custom_section\n        frm.set_value('__newname', frm.doc.custom_type + '-' + frm.doc.custom_section + '-' + frm.doc.category_name + '-' + frm.doc.custom_sub_category);\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Memorandum Invoice",
  "enabled": 1,
  "modified": "2023-12-28 15:04:52.331089",
  "module": "Ambica Finance",
  "name": "Get full address from address name",
  "script": "frappe.ui.form.on(\"Memorandum Invoice\", \"company_address_name\", function(frm, cdt, cdn) {\n    if(frm.doc.company_address_name){\n      return frm.call({\n      method: \"frappe.contacts.doctype.address.address.get_address_display\",\n      args: {\n         \"address_dict\": frm.doc.company_address_name\n      },\n      callback: function(r) {\n        if(r.message)\n            frm.set_value(\"company_address\", r.message);\n        \n      }\n     });\n    }\n    else{\n        frm.set_value(\"company_address\", \"\");\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Payment Entry",
  "enabled": 1,
  "modified": "2024-01-02 19:24:19.427381",
  "module": "Ambica Finance",
  "name": "Set Cheque/Reference No",
  "script": "var isChequeBookOver = false;\nfrappe.ui.form.on('Payment Entry', {\n    onload: function(frm) {\n        setReferenceNoBasedOnAccountTypes(frm);\n    },\n    paid_from: function(frm) {\n        setReferenceNoBasedOnAccountTypes(frm);\n    },\n    paid_to: function(frm) {\n        setReferenceNoBasedOnAccountTypes(frm);\n    },\n    before_save: function(frm) {\n        if (isChequeBookOver) {\n            frappe.msgprint(__('Cheque Book is over. Cannot create a new Payment Entry.'));\n            frappe.validated = false; // Prevent form save\n        }\n    }\n});\n\n\n\nfunction setReferenceNoBasedOnAccountTypes(frm) {\n    var paidFromAccount = frm.doc.paid_from;\n    var paidToAccount = frm.doc.paid_to;\n\n    // Fetch the account type for paid_from\n    fetchAccountType(paidFromAccount, function(accountTypeFrom) {\n        console.log('Paid From Account Type:', accountTypeFrom);\n\n        // Fetch the account type for paid_to\n        fetchAccountType(paidToAccount, function(accountTypeTo) {\n            console.log('Paid To Account Type:', accountTypeTo);\n\n              if (accountTypeFrom === 'Bank' || accountTypeTo === 'Bank') {\n                    if (frm.is_new()) {\n                       fetchChequeBookInfoAndSetReferenceNo(frm);\n                    }\n                } \n                else {\n                    // Set reference_no to a different value if needed\n                    frm.set_value('reference_no', '');\n                }\n        });\n    });\n}\n\nfunction fetchAccountType(account, callback) {\n    frappe.call({\n        method: 'frappe.client.get_value',\n        args: {\n            doctype: 'Account',\n            fieldname: 'account_type',\n            filters: { name: account }\n        },\n        callback: function(response) {\n            var accountType = response.message ? response.message.account_type : '';\n            callback(accountType);\n        }\n    });\n}\n\n\nfunction fetchChequeBookInfoAndSetReferenceNo(frm) {\n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Cheque Book',\n            fields: ['name', 'from_no', 'last_no'],\n            filters: {},\n            order_by: 'creation desc',\n            limit: 1\n        },\n        callback: function(response) {\n            if (response.message && response.message.length > 0) {\n                var chequeBooksList = response.message;\n                var fromNo = chequeBooksList[0].from_no;\n                var lastNo = chequeBooksList[0].last_no;\n\n                frappe.call({\n                    method: 'frappe.client.get_list',\n                    args: {\n                        doctype: 'Payment Entry',\n                        fields: ['reference_no'],\n                        order_by: 'creation desc',\n                        limit: 1\n                    },\n                    callback: function(lastResponse) {\n                        var lastAssignedReferenceNo = lastResponse.message && lastResponse.message.length > 0\n                            ? parseInt(lastResponse.message[0].reference_no) || fromNo\n                            : fromNo;\n\n                        if (lastAssignedReferenceNo >= fromNo && lastAssignedReferenceNo <= lastNo) {\n                            // Check if the form is new or existing\n                            if (!frm.doc.__islocal) {\n                                // If the form is existing, don't increment reference_no again\n                                frm.set_value('reference_no', lastAssignedReferenceNo);\n                            } else {\n                                lastAssignedReferenceNo += 1;\n\n                                if (lastAssignedReferenceNo > lastNo) {\n                                    isChequeBookOver = true; // Set the flag to indicate Cheque Book is over\n                                    frappe.msgprint(__('Cheque Book is over. Create a new Cheque Book.'));\n                                    // Add code to create a new Cheque Book here if needed.\n                                } else {\n                                    frm.set_value('reference_no', lastAssignedReferenceNo);\n                                }\n                            }\n                        } else {\n                            lastAssignedReferenceNo = fromNo;\n                            frm.set_value('reference_no', lastAssignedReferenceNo);\n                        }\n\n                        console.log('Cheque Book Number Range:');\n                        for (var i = fromNo; i <= lastNo; i++) {\n                            console.log(i);\n                        }\n                    }\n                });\n            }\n        }\n    });\n}",
  "view": "Form"
 }
]